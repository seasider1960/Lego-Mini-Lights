<!--

Lego Mini App Controlled Lights Project

THIS SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY OR FITNESS
FOR A PARTICULAR PURPOSE.  IT MAY INFRINGE THE INTELLECTUAL PROPERTY RIGHTS OF OTHERS
IN WHICH CASE I'D BE IN TROUBLE AS WELL AS YOU BUT I WILL NOT DEFEND OR INDEMNIFY YOU
FOR ANY LOSS YOU MAY INCUR.

WHAT THAT MEANS IS THAT IF THE SOFTWARE DOESN'T WORK, YOU ARE ON YOUR OWN.
SAME IF YOU DIE OR ARE INJURED USING IT, THOUGH I'D BE INTERESTED IN HEARING HOW YOU MANAGED THAT.  
UNLESS YOU STEP ON A LEGO BRICK I SUPPOSE. STILL, THAT WOULDN'T BE MY FAULT, REALLY.

ANY USE OF THIS SOFRWARE MEANS YOU HAVE AGREED TO ALL THAT.  SO THERE.

-->


<html charset="UTF-8">
  <head>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'>
    <link rel="stylesheet" href="css/StylesMini.css">
    <link rel="apple-touch-icon" sizes="57x57" href="images/Mini_Icon57.png" />  <!--Set of icons for adding to iPhone homescreen-->
    <link rel="apple-touch-icon" sizes="72x72" href="images/Mini_Icon72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="images/Mini_Icon144.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="images/Mini_Icon114.png" />
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
    <script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js'></script>
    <style> .redtext { color: red;}</style>
    <style>.greentext { color: green;}</style>
    <style>.bluetext { color: blue;}</style>
   <body>
    <div class="container-fluid">
      <div class= "row">
        <div class="col-md-12 jumbotron">
          <div class="text-center">
            <h1>LEGO MINI CONTROLS</h1>
           </div>
          </div> 
          <h4 class="text-center">EXTERIOR LIGHTING</h4>
          <br><br> 
          <div class="col-xs-3 col-md-3">
            <div class="btn btn-block" id="HL" style="background-color:#999" type="button" onclick="HLOnOff();"><span>HL</span></div>
            <div class="btn btn-block" id="FL" style="background-color:#999" type="button" onclick="FLOnOff();"><span>FL</span> </div>
            <div  class="btn btn-block" id="HZ" style="background-color:#999" type="button" onclick="HZOnOff();"><span class="glyphicon glyphicon-warning-sign"></span> </div>
          </div>
          <hr>  
          <div class="col-xs-3 col-md-2">      
            <div class="btn btn-block" id="L" style="background-color:#999" type="button" onclick="FlashL();"><span class="glyphicon glyphicon-backward"></span> </div>
            <div class="btn btn-block" id="R" style="background-color:#999" type="button" onclick="FlashR();"><span class="glyphicon glyphicon-forward"></span>  
          </div>
          <hr>
          <form style="text-align: center">
            <label class="radio-inline"><input type="radio" name="optradio" onclick="AutoOn();">Auto Lights On</label>
            <label class="radio-inline"><input type="radio" name="optradio" onclick="AutoOff();">Auto Lights Off</label>
          </form>
          <hr>
          <h4 class="text-center">INTERIOR LIGHTING</h4>
          <div class="btn btn-block" id="rainbow" style="background-color:#999" type="button" onclick="rainbowEffect();"><span class="glyphicon glyphicon glyphicon-refresh"></span> "GROOVY" MODE <span class="glyphicon glyphicon glyphicon-refresh"></span>  </div>
          <br><br> 
          <h4 class="text-center">Manual Control</h4>
          <table style="width:100%">
            <tr>
              <td class="redtext" style="text-align: center">Red Brightness </td>
            </tr>
            <tr>
              <td ><input class="enabled" id="r" type="range" min="0" max="1023" step="1" oninput="sendRGB();" value="0"></td>
            </tr>
            <tr>
              <td class="greentext" style="text-align: center">Green Brightness </td>
            </tr>
            <td><input class="enabled" id="g" type="range" min="0" max="1023" step="1" oninput="sendRGB();" value="0"></td>
          </tr>
          <tr>
            <td class="bluetext" style="text-align: center">Blue Brightness </td>
          </tr>
          <tr>
            <td><input class="enabled" id="b" type="range" min="0" max="1023" step="1" oninput="sendRGB();" value="0"></td>
          </tr>
        </table>
	     <hr>
       <div class="col-lg">
        <h4 class="text-center">CONFIGURATION</h4>
        <h5 class="text-center">Set Time Zone</h5> 
        <form style="text-align: center">
          <select id="t" onchange="sendTZ();">
            <option value="0">Select Time Zone</option>
            <option value="13">UCT-12</option>
            <option value="14">UCT-11</option>
            <option value="15">UCT-10</option>
            <option value="16">UCT-9</option>
            <option value="17">UCT-8</option>
            <option value="18">UCT-7</option>
            <option value="19">UCT-6</option>
            <option value="20">UCT-5 (Toronto Standard)</option>
            <option value="21">UCT-4 (Toronto DST)</option>
            <option value="22">UCT-3 (Legoland, CA)</option>
            <option value="23">UCT-2</option>
            <option value="24">UCT-1 (Cowley, UK /BST)</option>
            <option value="0">UCT (Cowley, UK/GMT)</option>
            <option value="1">UCT+1 (Legoland, Billund)</option>
            <option value="2">UCT=2</option>
            <option value="3">UCT+3</option>
            <option value="4">UCT+4 (Legoland, Dubai)</option>
            <option value="5">UCT+5</option>
            <option value="6">UCT+6</option>
            <option value="7">UCT+7</option>
            <option value="8">UCT+8</option>
            <option value="9">UCT+9 (Legoland, Japan)</option>
            <option value="10">UCT+10</option>
            <option value="11">UCT+11</option>
            <option value="12">UCT+12</option> 
          </select>
        </form>
      </div>
    </div> 
  </form>
  <br><br> 
<!--JS Scripts-->

<script type='text/javascript'>

var HLEnable = false;
var FLEnable = false;
var HZEnable = false;
var HNEnable = false;
var LEnable = false;
var REnable = false;
var rainbowEnable = false;
var timer;
var miliseconds = 500;
var intervalIdHZ;
var intervalIdR;
var intervalIdL;
var connection = new WebSocket('ws://' + location.hostname + ':81/', ['arduino']);
connection.onopen = function () {
  connection.send('Connect ' + new Date());
};
connection.onerror = function (error) {
  console.log('WebSocket Error ', error);
};
connection.onmessage = function (e) {
  console.log('Server: ', e.data);
};
connection.onclose = function () {
  console.log('WebSocket connection closed');
};

function sendRGB () {
  var r = document.getElementById('r').value** 2 / 1023;
  var g = document.getElementById('g').value** 2 / 1023;
  var b = document.getElementById('b').value** 2 / 1023;

  var rgb = r << 20 | g << 10 | b;
  var rgbstr = '#' + rgb.toString(16);
  console.log('RGB: ' + rgbstr);
  connection.send(rgbstr);
}

function rainbowEffect () {
  rainbowEnable = ! rainbowEnable;
  if (rainbowEnable) {
    connection.send("A");
    document.getElementById('rainbow').style.backgroundColor = '#33C7FF';
    document.getElementById('r').className = 'disabled';
    document.getElementById('g').className = 'disabled';
    document.getElementById('b').className = 'disabled';
    document.getElementById('r').disabled = true;
    document.getElementById('g').disabled = true;
    document.getElementById('b').disabled = true;
  } else {
    connection.send("B");
    document.getElementById('rainbow').style.backgroundColor = '#999';
    document.getElementById('r').className = 'enabled';
    document.getElementById('g').className = 'enabled';
    document.getElementById('b').className = 'enabled';
    document.getElementById('r').disabled = false;
    document.getElementById('g').disabled = false;
    document.getElementById('b').disabled = false;
    sendRGB();
  }
}

function HLOnOff () {
  HLEnable = ! HLEnable;
  if (HLEnable) {
    connection.send("C");
    document.getElementById('HL').style.backgroundColor = '#0000FF';
  } else {
    connection.send("D");
    document.getElementById('HL').style.backgroundColor = '#999';
  }
}

function FLOnOff () {
  FLEnable = ! FLEnable;
  if (FLEnable) {
    connection.send("E");
    document.getElementById('FL').style.backgroundColor = '#FFD333';
  } else {
    connection.send("F");
    document.getElementById('FL').style.backgroundColor = '#999';
  }
}

function setColorHZ() {
  var x = document.getElementById('HZ');
  x.style.backgroundColor = x.style.backgroundColor == "orange" ? "gray" : "orange";
}

function setColorR() {
  var x = document.getElementById('R');
  x.style.backgroundColor = x.style.backgroundColor == "green" ? "gray" : "green";
}

function setColorL() {
  var x = document.getElementById('L');
  x.style.backgroundColor = x.style.backgroundColor == "green" ? "gray" : "green";
}

function stopColor() {
  clearInterval(myVar);
}

function HZOnOff () {
  HZEnable = ! HZEnable;
  if (HZEnable) {
    connection.send("G");
    toggleIntervalHZ();
    
  } else {
  connection.send("H");
  toggleIntervalHZ();
  clearInterval(intervalIdHZ);
  document.getElementById('HZ').style.backgroundColor = '#999';
  
  }
}

function toggleIntervalHZ() {
  if (!intervalIdHZ) {
    intervalIdHZ = setInterval(function(){setColorHZ();}, 600);
  } else {
    clearInterval(intervalIdHZ);
    intervalIdHZ = null;
  }
}

function toggleIntervalR() {
  if (!intervalIdR) {
    intervalIdR = setInterval(function(){setColorR();}, 600);
  } else {
    clearInterval(intervalIdR);
    intervalIdR = null;
  }
}

function toggleIntervalL() {
  if (!intervalIdL) {
    intervalIdL = setInterval(function(){setColorL();}, 600);
  } else {
    clearInterval(intervalIdL);
    intervalIdL = null;
  }
}

function FlashL () {
  LEnable = ! LEnable;
  if (LEnable) {   
    if (REnable) {
      connection.send("N");
      toggleIntervalR();
      clearInterval(intervalIdR);
      document.getElementById('R').style.backgroundColor = '#999';
    }
  connection.send("K");
  toggleIntervalL();
  } else {
      connection.send("L");
      toggleIntervalL();
      document.getElementById('L').style.backgroundColor = '#999';
    }
}



function FlashR () {
  REnable = ! REnable;
  if (REnable) {   
    if (LEnable) {
      connection.send("L");
      toggleIntervalL();
      clearInterval(intervalIdL);
      document.getElementById('L').style.backgroundColor = '#999';
    }
  connection.send("M");
  toggleIntervalR();
  } else {
      connection.send("N");
      toggleIntervalR();
      document.getElementById('R').style.backgroundColor = '#999';
    }
}
 
  function AutoOn () {
    connection.send("R"); 
  }

function AutoOff () {
  connection.send("S");
}


function sendTZ () {
  var t = document.getElementById('t').value;
  var tstr = 'O' +  t.toString(16); 
  console.log('Timezone: ' + tstr);
  connection.send(tstr);  
}

/**
* Function to toggle colors
**/
function toggleColors( colors ){
    clearTimeout(timer);
    var counter = 0
    var change = function(){
        document.getElementById('HZ').bgColor = colors[ counter%colors.length ];// Change the color
        counter ++;
        if( colors.length > 1 )
            timer = setTimeout(change, miliseconds); // Call the changer
    };
    change();
}

  </script>
  <br><br> 
</body> 
</html>